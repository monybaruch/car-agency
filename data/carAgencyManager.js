const agencies = [
  {
    agencyName: 'Best Deal',
    cash: 1245000,
    credit: 200000,
    agencyId: 'Plyq5M5AZ',

    cars: [
      {
        brand: 'bmw',
        models: [
          {
            name: '3',
            year: 2015,
            price: 137000,
            carNumber: 'AZJZ4',
            ownerId: 'Plyq5M5AZ',
          },
          {
            name: 'X6',
            year: 2020,
            price: 966500,
            carNumber: 'S6DL1',
            ownerId: 'Plyq5M5AZ',
          },
        ],
      },
      {
        brand: 'toyota',
        models: [
          {
            name: 'Land Cruiser',
            year: 2020,
            price: 336300,
            carNumber: '6rvXw',
            ownerId: 'Plyq5M5AZ',
          },
          {
            name: 'Hilux',
            year: 2005,
            price: 35005,
            carNumber: 'MWXBG',
            ownerId: 'Plyq5M5AZ',
          },
          {
            name: 'Corolla',
            year: 2020,
            price: 111900,
            carNumber: 'hCzl-',
            ownerId: 'Plyq5M5AZ',
          },
        ],
      },
      {
        brand: 'Ford',
        models: [
          {
            name: 'Focus',
            year: 2020,
            price: 98200,
            carNumber: 'kN3HP',
            ownerId: 'Plyq5M5AZ',
          },
          {
            name: 'Focus',
            year: 2005,
            price: 6502,
            carNumber: 'LJTCs',
            ownerId: 'Plyq5M5AZ',
          },
        ],
      },
      {
        brand: 'Alpha romeo',
        models: [
          {
            name: 'Romeo Julia',
            year: 2020,
            price: 275406,
            carNumber: '2kjy7',
            ownerId: 'Plyq5M5AZ',
          },
          {
            name: 'Romeo Stelvio',
            year: 2019,
            price: 215403,
            carNumber: '7A5b-',
            ownerId: 'Plyq5M5AZ',
          },
        ],
      },
      {
        brand: 'Chevrolet',
        models: [
          {
            name: 'Traverse',
            year: 2020,
            price: 201102,
            carNumber: 'QwBOT',
            ownerId: 'Plyq5M5AZ',
          },
          {
            name: 'Impala',
            year: 2019,
            price: 165041,
            carNumber: '2v4jt',
            ownerId: 'Plyq5M5AZ',
          },
          {
            name: 'Malibu',
            year: 2017,
            price: 75405,
            carNumber: 'O4_Jv',
            ownerId: 'Plyq5M5AZ',
          },
        ],
      },
    ],
  },
  {
    agencyName: 'CarMax',
    cash: 968541,
    credit: 500000,
    agencyId: '26_IPfHU1',
    cars: [
      {
        brand: 'bmw',
        models: [
          {
            name: 'X5',
            year: 2015,
            price: 218000,
            carNumber: '4Ixb0',
            ownerId: '26_IPfHU1',
          },
          {
            name: 'X6',
            year: 2014,
            price: 97100,
            carNumber: 'kAnv-',
            ownerId: '26_IPfHU1',
          },
          {
            name: 'Z4',
            year: 2019,
            price: 296900,
            carNumber: 'ISMdU',
            ownerId: '26_IPfHU1',
          },
          {
            name: '3',
            year: 2010,
            price: 75100,
            carNumber: '9DJPw',
            ownerId: '26_IPfHU1',
          },
        ],
      },
      {
        brand: 'toyota',
        models: [
          {
            name: 'Land Cruiser',
            year: 2005,
            price: 80540,
            carNumber: 'Kt-pW',
            ownerId: '26_IPfHU1',
          },
          {
            name: 'Corolla',
            year: 2019,
            price: 109100,
            carNumber: 'YiYdI',
            ownerId: '26_IPfHU1',
          },
          {
            name: 'Hilux',
            year: 2019,
            price: 204000,
            carNumber: 'DRmNw',
            ownerId: '26_IPfHU1',
          },
        ],
      },
      {
        brand: 'Ford',
        models: [
          {
            name: 'F250',
            year: 2020,
            price: 198500,
            carNumber: 'g4Wfp',
            ownerId: '26_IPfHU1',
          },
          {
            name: 'Explorer',
            year: 2020,
            price: 265200,
            carNumber: 'iNT8Q',
            ownerId: '26_IPfHU1',
          },
        ],
      },
      {
        brand: 'Alpha romeo',
        models: [
          {
            name: 'Spider',
            year: 2011,
            price: 75405,
            carNumber: '6t7QU',
            ownerId: '26_IPfHU1',
          },
          {
            name: '166',
            year: 2002,
            price: 12400,
            carNumber: 'XMqpn',
            ownerId: '26_IPfHU1',
          },
        ],
      },
      {
        brand: 'Chevrolet',
        models: [
          {
            name: 'Impala',
            year: 2016,
            price: 65042,
            carNumber: 'vbeAo',
            ownerId: '26_IPfHU1',
          },
          {
            name: 'Savannah',
            year: 2016,
            price: 76505,
            carNumber: 'WelWa',
            ownerId: '26_IPfHU1',
          },
        ],
      },
    ],
  },
  {
    agencyName: 'The Auto World',
    cash: 687450,
    credit: 200000,
    agencyId: 'gNHjNFL12',
    cars: [
      {
        brand: 'bmw',
        models: [
          {
            name: 'X6',
            year: 2018,
            price: 548100,
            carNumber: 'EMW_7',
            ownerId: 'gNHjNFL12',
          },
          {
            name: '3',
            year: 2017,
            price: 178000,
            carNumber: 'XlnB4',
            ownerId: 'gNHjNFL12',
          },
        ],
      },
      {
        brand: 'toyota',
        models: [
          {
            name: 'Prius',
            year: 2017,
            price: 101542,
            carNumber: '-RQgN',
            ownerId: 'gNHjNFL12',
          },
          {
            name: 'Highlander',
            year: 2017,
            price: 202540,
            carNumber: 'AZJZ4',
            ownerId: 'gNHjNFL12',
          },
          {
            name: 'Corolla',
            year: 1996,
            price: 5420,
            carNumber: 'kHE8f',
            ownerId: 'gNHjNFL12',
          },
          {
            name: 'Corolla',
            year: 2012,
            price: 40570,
            carNumber: 'p2qEi',
            ownerId: 'gNHjNFL12',
          },
        ],
      },
      {
        brand: 'Ford',
        models: [
          {
            name: 'Explorer',
            year: 2014,
            price: 127502,
            carNumber: 'Ty1zN',
            ownerId: 'gNHjNFL12',
          },
          {
            name: 'F350',
            year: 2012,
            price: 54250,
            carNumber: 'z03H2',
            ownerId: 'gNHjNFL12',
          },
        ],
      },
      {
        brand: 'Chevrolet',
        models: [
          {
            name: 'Savannah',
            year: 2010,
            price: 36504,
            carNumber: 'RXFZe',
            ownerId: 'gNHjNFL12',
          },
          {
            name: 'Malibu',
            year: 2009,
            price: 19585,
            carNumber: 'K5IsM',
            ownerId: 'gNHjNFL12',
          },
        ],
      },
    ],
  },
  {
    agencyName: 'Car Werks',
    cash: 302502,
    credit: 150000,
    agencyId: '9KeaYbRLP',
    cars: [
      {
        brand: 'bmw',
        models: [
          {
            name: '8',
            year: 2020,
            price: 942500,
            carNumber: '4IUMz',
            ownerId: '9KeaYbRLP',
          },
          {
            name: 'X6',
            year: 2010,
            price: 129000,
            carNumber: 'Vw0fV',
            ownerId: '9KeaYbRLP',
          },
          {
            name: 'X3',
            year: 2019,
            price: 358100,
            carNumber: 'ufN54',
            ownerId: '9KeaYbRLP',
          },
          {
            name: '3',
            year: 2020,
            price: 389100,
            carNumber: 'F127X',
            ownerId: '9KeaYbRLP',
          },
          {
            name: '3',
            year: 2002,
            price: 18400,
            carNumber: 'ueZUp',
            ownerId: '9KeaYbRLP',
          },
        ],
      },
      {
        brand: 'toyota',
        models: [
          {
            name: 'Prius',
            year: 2011,
            price: 38520,
            carNumber: 'AZJZ4',
            ownerId: '9KeaYbRLP',
          },
          {
            name: 'Land Cruiser',
            year: 2019,
            price: 290040,
            carNumber: 'AZJZ4',
            ownerId: '9KeaYbRLP',
          },
          {
            name: 'Hilux',
            year: 2020,
            price: 215700,
            carNumber: 'xig8N',
            ownerId: '9KeaYbRLP',
          },
          {
            name: 'Hilux',
            year: 2015,
            price: 178506,
            carNumber: 'ghTiQ',
            ownerId: '9KeaYbRLP',
          },
          {
            name: 'Corolla',
            year: 2002,
            price: 8504,
            carNumber: 'Mvw8T',
            ownerId: '9KeaYbRLP',
          },
        ],
      },
      {
        brand: 'Chevrolet',
        models: [
          {
            name: 'Impala',
            year: 2005,
            price: 9320,
            carNumber: 'BZpkt',
            ownerId: '9KeaYbRLP',
          },
          {
            name: 'Malibu',
            year: 2002,
            price: 4502,
            carNumber: 'KqKV_',
            ownerId: '9KeaYbRLP',
          },
        ],
      },
    ],
  },
  {
    agencyName: 'Carsova',
    cash: 72450,
    credit: 50000,
    agencyId: 'oqQmsZoUo',
    cars: [
      {
        brand: 'bmw',
        models: [
          {
            name: '7',
            year: 1999,
            price: 24700,
            carNumber: 'sZrjp',
            ownerId: 'oqQmsZoUo',
          },
          {
            name: '3',
            year: 2008,
            price: 54000,
            carNumber: 'da88K',
            ownerId: 'oqQmsZoUo',
          },
        ],
      },
      {
        brand: 'toyota',
        models: [
          {
            name: 'Prius',
            year: 2019,
            price: 124050,
            carNumber: 'ZfbqH',
            ownerId: 'oqQmsZoUo',
          },
          {
            name: 'Hilux',
            year: 1996,
            price: 11540,
            carNumber: 'AZJZ4',
            ownerId: 'oqQmsZoUo',
          },
        ],
      },
    ],
  },
];

const carAgencyManager = {
  ...agencies,
  // Search for a car agency by its name or ID.
  // @param {string} idOrName - ID or name of the agency
  // @return {object} - agency object if found, otherwise null
  searchAgency(idOrName) {
    const agencyWasFound = agencies.find((agency) => {
      return agency.agencyName === idOrName || agency.agencyId === idOrName;
    });
    if (agencyWasFound) {
      return agencyWasFound;
    } else {
      console.log(`The agency with the id or name of ${idOrName} wasn't found try a different agency name or id`);
      return null;
    }
  },
  // getAllAgenciesName
  // @return {string[]} - agenciesNameArr - Array of all agencies name
  getAllAgenciesName() {
    let agenciesNames = agencies.map((agency) => agency.agencyName);
    return agenciesNames;
  },
  // Add a new car to an agency's inventory.
  // @param {string} agencyId - The ID of the agency
  // @param {object} car - The car object to be added
  // @return {boolean} - true if added successfully, false otherwise
  addCarToAgency(agencyId, car) {
    const filteredAgency = this.searchAgency(agencyId);
    return filteredAgency
      ? filteredAgency.cars.push(car)
      : `The agency with the id or name of ${agencyId} wasn't found try a different agency name or id`;
  },

  // Remove a car from an agency's inventory.
  // @param {string} agencyId - The ID of the agency
  // @param {string} carId - The ID of the car to be removed
  // @return {boolean} - true if removed successfully, false otherwise
  removeCarFromAgency(agencyId, carId) {
    const filteredAgency = this.searchAgency(agencyId);
    const filteredCars = filteredAgency.cars.find((carObj) =>
      carObj.models.find((carNum) => carNum.carNumber === carId)
    );
    if (filteredCars && filteredCars) {
      filteredAgency.cars.map((carObj) => (carObj.models = carObj.models.filter((model) => model.carNumber !== carId)));
      return true;
    }
    return false;
  },
  // 6 Change the cash or credit of an agency.
  // @param {string} agencyId - The ID of the agency
  // @param {string} cashOrCredit - type of cash or credit to be updated
  // @param {number} cashOrAmount - The amount of cash or credit to be updated
  // @return {boolean} - true if updated successfully, false otherwise
  changeAgencyCashOrCredit(agencyId, cashOrCreditStr, cashOrCreditAmount) {
    const filteredAgency = this.searchAgency(agencyId);
    if (filteredAgency) {
      filteredAgency[cashOrCreditStr] = cashOrCreditAmount;
      return true;
    }
    return false;
  },
  // Update the price of a specific car in an agency.
  // @param {string} agencyId - The ID of the agency
  // @param {string} carId - The ID of the car
  // @param {number} newPrice - The new price of the car
  // @return {boolean} - true if updated successfully, false otherwise
  updateCarPrice(agencyId, carId, newPrice) {
    const filteredAgency = this.searchAgency(agencyId);
    const filteredCars = filteredAgency.cars.find((carObj) =>
      carObj.models.find((carNum) => carNum.carNumber === carId)
    );
    if (filteredAgency && filteredCars) {
      filteredAgency.cars.map((carObj) =>
        carObj.models.find((carModel) => {
          if (carModel.carNumber === carId) {
            carModel.price = newPrice;
          }
        })
      );
      console.log(filteredCars);
      return true;
    }
    return false;
  },
  // Calculate and return the total revenue for a specific agency.
  // @param {string} agencyId - The ID of the agency
  // @return {number} - The total revenue of the agency
  getTotalAgencyRevenue(agencyId) {
    const filteredAgency = this.searchAgency(agencyId);
    let totalRevenue = 0;
    if (filteredAgency) {
      totalRevenue = filteredAgency.cash + filteredAgency.credit;
      return totalRevenue;
    } else {
      return `The agency with the id or name of ${agencyId} wasn't found try a different agency name or id`;
    }
  },
  // Transfer a car from one agency to another.
  // @param {string} fromAgencyId - The ID of the agency from where the car will be transferred
  // @param {string} toAgencyId - The ID of the agency to where the car will be transferred
  // @param {string} carId - The ID of the car to be transferred
  // @return {boolean} - true if transferred successfully, false otherwise
  transferCarBetweenAgencies(fromAgencyId, toAgencyId, carId) {
    const fromAgencySwap = this.searchAgency(fromAgencyId);
    const toAgencySwap = this.searchAgency(toAgencyId);
    const swappedCarId = {
      ...fromAgencySwap.cars.find((carObj) => carObj.models.find((carModel) => carModel.carNumber === carId)),
    };
    // test to check that i got all the variables correctly
    console.log(fromAgencySwap);
    console.log(toAgencySwap);
    console.log(swappedCarId);
    if (fromAgencySwap && toAgencySwap && swappedCarId) {
      swappedCarId.models = swappedCarId.models.filter((model) => model.carNumber === carId);
      this.addCarToAgency(toAgencyId, swappedCarId);
      this.removeCarFromAgency(fromAgencyId, carId);
      return true;
    }
    return false;
  },
};
// if (searchedFromAgency && searchedToAgency && searchCarModel) {
//   searchCarModel.models = searchCarModel.models.filter((model) => model.carNumber === carId);
//   this.addCarToAgency(toAgencyId, searchCarModel);
//   this.removeCarFromAgency(fromAgencyId, carId);
//   return true;
// }

//tests
const car = {
  brand: 'nisan',
  models: [
    {
      name: '3',
      year: 2022,
      price: 155000,
      carNumber: '644545',
      ownerId: 'dopfdio',
    },
  ],
};

console.log(carAgencyManager.searchAgency('The Auto World'));

console.log(carAgencyManager.getAllAgenciesName());

console.log(carAgencyManager.addCarToAgency('Carsova', car));
console.log(carAgencyManager);

console.log(carAgencyManager.removeCarFromAgency('Carsova', '644545'));
console.log(carAgencyManager.removeCarFromAgency('Carsova', 'AZJZ4'));
console.log(carAgencyManager.removeCarFromAgency('Carsova', 'ZfbqH'));
console.log(carAgencyManager);

console.log(carAgencyManager.changeAgencyCashOrCredit('Carsova', 'cash', 1500));
console.log(carAgencyManager);

console.log(carAgencyManager.updateCarPrice('Best Deal', 'AZJZ4', 7500));

console.log(carAgencyManager.getTotalAgencyRevenue('Carsova'));

console.log(carAgencyManager.transferCarBetweenAgencies('Best Deal', 'CarMax', '7A5b-'));

export { agencies, carAgencyManager };
